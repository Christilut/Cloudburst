<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8"/>
		<title>Cloudburst</title>

		<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

		<link rel="stylesheet" href="css/isotope.css" />
		<link rel="stylesheet" href="css/style.css" />
	</head>

	<body>
		<h1>imagesLoaded with jQuery</h1>
		<div id="demo">
		  <div class="buttons">
			<button id="add">Add images</button>
			<button id="reset">Reset</button>
		  </div>
		  <div id="status">
			<progress max="7" value="0"></progress>
		  </div>
		  <div id="image-container"></div>
		</div>
		

		<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
		<script type="text/javascript" src="js/jquery.isotope.js"></script>
		<script type="text/javascript" src="js/json2html.js"></script>
		<script type="text/javascript" src="js/jquery.json2html.js"></script>
		<script type="text/javascript" src="js/imagesloaded.pkgd.js"></script>
		<script type="text/javascript">
			( function( window ) {

			'use strict';

			var $progress, $status;
			var supportsProgress;
			var loadedImageCount, imageCount;

			$( function() {
			  var $demo = $('#demo');
			  var $container = $demo.find('#image-container');
			  $status = $demo.find('#status');
			  $progress = $demo.find('progress');

			  supportsProgress = $progress[0] &&
				// IE does not support progress
				$progress[0].toString().indexOf('Unknown') === -1;

			  $('#add').click( function() {
				// add new images
				
				var items = getImageItem('ted');
				items += getImageItem('the-hunger-games');
				items += getImageItem('the-hunger-games-mockingjay-part-1');
				items += getImageItem('underworld-awakening');
	
				console.log( items );
				$container.prepend( $(items) );
				// use ImagesLoaded
				$container.imagesLoaded()
				  .progress( onProgress )
				  .always( onAlways );
				// reset progress counter
				imageCount = $container.find('img').length;
				resetProgress();
				updateProgress( 0 );
			  });

			  // reset container
			  $('#reset').click( function() {
				$container.empty();
			  });
			});

			// -----  ----- //

			// return doc fragment with
			function getItems() {
			  var items = '';
			  for ( var i = 0; i < 7; i++ ) {
				items += getImageItem();
			  }
			  return items;
			}

			// return an <li> with a <img> in it
			function getImageItem(name) {
			  var item = '<li class="is-loading">';
			  item.className = 'is-loading';
			  var size = Math.random() * 3 + 1;
			  var width = Math.random() * 110 + 100;
			  width = Math.round( width * size );
			  var height = Math.round( 140 * size );
			  var rando = Math.ceil( Math.random() * 1000 );
			  // 10% chance of broken image src
			  // random parameter to prevent cached images
			  
			  item += '<img src="../images/covers/' + name + '.jpg" /></li>';
			  return item;
			}

			// -----  ----- //

			function resetProgress() {
			  $status.css({ opacity: 1 });
			  loadedImageCount = 0;
			  if ( supportsProgress ) {
				$progress.attr( 'max', imageCount );
			  }
			}

			function updateProgress( value ) {
			  if ( supportsProgress ) {
				$progress.attr( 'value', value );
			  } else {
				// if you don't support progress elem
				$status.text( value + ' / ' + imageCount );
			  }
			}

			// triggered after each item is loaded
			function onProgress( imgLoad, image ) {
			  // change class if the image is loaded or broken
			  var $item = $( image.img ).parent();
			  $item.removeClass('is-loading');
			  if ( !image.isLoaded ) {
				$item.addClass('is-broken');
			  }
			  // update progress element
			  loadedImageCount++;
			  updateProgress( loadedImageCount );
			}

			// hide status when done
			function onAlways() {
			  $status.css({ opacity: 0 });
			}

			})( window );
		
		
		</script>
	</body>
</html>